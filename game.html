<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>PuzzlerWJ | Golden Clockwork</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Abril+Fatface&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- üåå The Void Background --- */
        body {
            background-color: #0f172a; 
            background-image: radial-gradient(circle at 50% 50%, #1e1b4b 0%, #020617 90%);
            color: #fbbf24;
            font-family: 'Abril Fatface', cursive;
            overflow: hidden;
            touch-action: none;
            user-select: none;
        }

        .font-mono { font-family: 'Share Tech Mono', monospace; }

        .dust {
            position: absolute;
            width: 2px; height: 2px;
            background: rgba(251, 191, 36, 0.3);
            border-radius: 50%;
            animation: float 10s infinite linear;
            pointer-events: none;
        }

        /* --- ‚öôÔ∏è The Gears --- */
        #mechanism {
            position: relative;
            width: 360px;
            height: 360px;
            display: flex;
            align-items: center;
            justify-content: center;
            filter: drop-shadow(0 30px 50px rgba(0,0,0,0.9));
        }

        @media (min-width: 768px) { #mechanism { width: 500px; height: 500px; } }

        .gear {
            position: absolute;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-sizing: border-box;
            transform: rotate(var(--rotation, 0deg)) scale(var(--scale, 1));
            transition: transform 0.5s cubic-bezier(0.34, 1.56, 0.64, 1), filter 0.3s ease, box-shadow 0.3s ease;
        }

        .gear:hover {
            --scale: 1.05;
            filter: brightness(1.2) contrast(1.1);
        }

        /* 1. Outer Gear */
        .gear-outer {
            width: 100%; height: 100%;
            z-index: 10;
            border: 12px dashed #334155;
            background: radial-gradient(circle, transparent 65%, #1e293b 66%),
                        conic-gradient(from 0deg, #1e293b 0%, #475569 50%, #0f172a 100%);
            box-shadow: inset 0 0 30px #000;
        }
        .gear-outer:hover { box-shadow: inset 0 0 30px #000, 0 0 30px rgba(71, 85, 105, 0.5); }

        /* 2. Middle Gear */
        .gear-middle {
            width: 70%; height: 70%;
            z-index: 20;
            border: 8px dashed #78350f;
            background: radial-gradient(circle, transparent 60%, #92400e 61%),
                        conic-gradient(from 45deg, #b45309 0%, #fbbf24 25%, #78350f 50%, #fbbf24 75%, #b45309 100%);
            box-shadow: 0 10px 20px rgba(0,0,0,0.5), inset 0 0 10px rgba(0,0,0,0.5);
        }
        .gear-middle:hover { box-shadow: 0 20px 40px rgba(0,0,0,0.6), inset 0 0 10px rgba(0,0,0,0.5); }

        /* 3. Inner Gear */
        .gear-inner {
            width: 45%; height: 45%;
            z-index: 30;
            border: 6px dashed #fbbf24;
            background: conic-gradient(from -45deg, #d97706 0%, #fcd34d 40%, #b45309 100%);
            box-shadow: 0 5px 15px rgba(0,0,0,0.6);
        }
        .gear-inner:hover { box-shadow: 0 10px 25px rgba(0,0,0,0.7), 0 0 20px rgba(251, 191, 36, 0.4); }

        /* --- üíé The Gem --- */
        .gem {
            position: absolute;
            top: 6px; left: 50%; transform: translateX(-50%);
            width: 10px; height: 10px; border-radius: 50%;
            background-color: #0f172a;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.9);
            transition: all 0.4s;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .gear-middle .gem { top: 4px; width: 12px; height: 12px; }
        .gear-inner .gem { top: 4px; width: 14px; height: 14px; }

        .gear.aligned .gem {
            background-color: #fbbf24;
            box-shadow: 0 0 10px #fbbf24, 0 0 20px #fbbf24;
            border-color: #fff;
        }

        /* --- üóùÔ∏è The Core --- */
        .core {
            position: absolute;
            width: 20%; height: 20%;
            background: radial-gradient(circle at 30% 30%, #475569, #0f172a);
            border-radius: 50%; z-index: 40;
            border: 2px solid #334155;
            box-shadow: inset 0 5px 10px rgba(0,0,0,0.8);
            cursor: default; transition: all 0.3s;
        }
        .core::after {
            content: ''; position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            width: 40%; height: 40%; background-color: #000;
            clip-path: polygon(20% 0%, 80% 0%, 100% 100%, 0% 100%);
            transition: background-color 0.3s;
        }
        .core.active {
            border-color: #fbbf24; box-shadow: 0 0 30px rgba(251, 191, 36, 0.5);
            cursor: pointer; animation: pulse-core 2s infinite;
        }
        .core.active::after { background-color: #fbbf24; box-shadow: 0 0 10px #fbbf24; }
        @keyframes pulse-core { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }

        .ref-line {
            position: absolute; top: -40px; left: 50%; width: 2px; height: 60px;
            background: linear-gradient(to bottom, #fbbf24, transparent);
            transform: translateX(-50%); z-index: 50; opacity: 0.6;
            filter: drop-shadow(0 0 5px #fbbf24);
        }

        @keyframes float { 0% { transform: translateY(0); opacity: 0; } 50% { opacity: 0.8; } 100% { transform: translateY(-100px); opacity: 0; } }

        /* Modal Backdrop */
        .modal-backdrop { 
            backdrop-filter: blur(15px); 
            background-color: rgba(0,0,0,0.7);
        }

        /* Card Style for Share */
        .result-card {
            background: linear-gradient(145deg, #1e1b4b, #0f172a);
            border: 1px solid #4338ca;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }
    </style>
</head>
<body class="flex flex-col items-center justify-center h-screen relative">

    <div id="dust-container" class="absolute inset-0 pointer-events-none overflow-hidden"></div>

    <!-- Header & Timer -->
    <div class="absolute top-8 text-center z-50 pointer-events-none">
        <h1 class="text-3xl text-amber-500/80 tracking-widest drop-shadow-lg">PuzzlerWJ</h1>
        <div class="flex items-center justify-center gap-2 mt-2">
            <span class="text-[10px] text-slate-500 tracking-[0.3em] uppercase">Time Elapsed</span>
        </div>
        <!-- ‚è±Ô∏è The Timer -->
        <div id="gameTimer" class="font-mono text-2xl text-amber-400 tracking-wider mt-1 drop-shadow-[0_0_5px_rgba(251,191,36,0.5)]">
            00:00
        </div>
    </div>

    <!-- Exit -->
    <a href="index.html" class="absolute top-8 right-8 text-slate-600 hover:text-amber-500 transition z-50">
        <i class="fas fa-times text-2xl"></i>
    </a>

    <!-- Game Board -->
    <div id="mechanism">
        <div class="ref-line"></div>
        <div class="gear gear-outer" id="g0" onclick="Game.handleClick(event, 0)"><div class="gem"></div></div>
        <div class="gear gear-middle" id="g1" onclick="Game.handleClick(event, 1)"><div class="gem"></div></div>
        <div class="gear gear-inner" id="g2" onclick="Game.handleClick(event, 2)"><div class="gem"></div></div>
        <div class="core" id="core" onclick="Game.triggerWin()"></div>
    </div>

    <div class="absolute bottom-16 text-amber-500/30 text-xs tracking-[0.2em] font-mono pointer-events-none" id="status-text">
        MECHANISM LOCKED
    </div>

    <!-- üèÜ 1. Reward Modal -->
    <div id="rewardModal" class="fixed inset-0 z-[100] hidden flex items-center justify-center modal-backdrop opacity-0 transition-opacity duration-1000">
        <div class="text-center relative">
            <div class="absolute inset-0 bg-amber-500/20 blur-3xl rounded-full"></div>
            <div class="relative z-10">
                <div class="inline-block w-20 h-20 mb-6 rounded-full border-4 border-amber-500 flex items-center justify-center shadow-[0_0_50px_#fbbf24] bg-black">
                    <i class="fas fa-key text-3xl text-amber-400"></i>
                </div>
                <h1 class="text-4xl text-white mb-2 tracking-widest drop-shadow-xl">UNLOCKED</h1>
                
                <div class="mt-8 bg-black/60 px-8 py-4 rounded border border-amber-500/50 backdrop-blur-md shadow-2xl">
                    <p class="font-sans text-[10px] text-amber-200 uppercase tracking-widest mb-1">Shipping Override Code</p>
                    <p class="font-mono text-2xl text-white tracking-[0.2em] select-all drop-shadow-md">GEARMASTER</p>
                </div>
                
                <!-- Button to go to Share Screen -->
                <button onclick="UI.showShareModal()" class="mt-8 bg-amber-500 text-indigo-950 font-bold py-3 px-8 rounded-full hover:bg-white transition shadow-lg hover:shadow-amber-500/50">
                    Continue <i class="fas fa-arrow-right ml-2"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- üì§ 2. Share Modal (Result Card) -->
    <div id="shareModal" class="fixed inset-0 z-[100] hidden flex items-center justify-center modal-backdrop opacity-0 transition-opacity duration-500">
        <div class="result-card p-8 rounded-xl max-w-sm w-full mx-4 relative transform scale-95 transition-transform duration-300" id="shareCard">
            <!-- Close -->
            <button onclick="location.reload()" class="absolute top-4 right-4 text-slate-500 hover:text-white transition">
                <i class="fas fa-redo"></i>
            </button>

            <!-- Card Content -->
            <div class="text-center">
                <div class="text-amber-500 text-4xl mb-2"><i class="fas fa-stopwatch"></i></div>
                <h2 class="text-white text-xl tracking-widest mb-1 font-bold">MISSION COMPLETE</h2>
                <p class="text-slate-400 text-xs uppercase tracking-widest mb-6">PuzzlerWJ Mechanism</p>

                <!-- Stats -->
                <div class="bg-indigo-950/50 rounded-lg p-6 border border-indigo-800 mb-6 relative overflow-hidden">
                    <div class="absolute top-0 right-0 p-2 opacity-20"><i class="fas fa-cog fa-spin text-4xl text-white"></i></div>
                    <p class="text-xs text-slate-400 font-mono mb-1">COMPLETION TIME</p>
                    <p class="text-4xl font-mono text-amber-400" id="finalTimeDisplay">00:00</p>
                </div>

                <!-- Share Buttons (Only Copy Link Remaining) -->
                <p class="text-xs text-slate-500 mb-4">CHALLENGE A FRIEND</p>
                <div class="flex justify-center gap-4">
                    <button onclick="UI.share('copy')" class="w-10 h-10 rounded-full bg-slate-800 hover:bg-green-500 hover:text-white text-slate-300 transition flex items-center justify-center" title="Copy Link">
                        <i class="fas fa-link"></i>
                    </button>
                </div>
                
                <div class="mt-8 pt-4 border-t border-indigo-900/50">
                    <a href="index.html" class="text-xs text-amber-500 hover:text-white transition tracking-widest uppercase">
                        <i class="fas fa-shopping-bag mr-1"></i> Return to Shop
                    </a>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- ‚è±Ô∏è Timer Logic ---
        const Timer = {
            startTime: null,
            timerInterval: null,
            el: document.getElementById('gameTimer'),
            isRunning: false,

            start: function() {
                if (this.isRunning) return;
                this.startTime = Date.now();
                this.isRunning = true;
                this.timerInterval = setInterval(() => {
                    this.update();
                }, 1000);
            },

            stop: function() {
                this.isRunning = false;
                clearInterval(this.timerInterval);
                return this.el.innerText;
            },

            update: function() {
                const now = Date.now();
                const diff = now - this.startTime;
                
                const minutes = Math.floor(diff / 60000);
                const seconds = Math.floor((diff % 60000) / 1000);
                
                const str = 
                    (minutes < 10 ? '0' : '') + minutes + ':' + 
                    (seconds < 10 ? '0' : '') + seconds;
                
                this.el.innerText = str;
            }
        };

        // --- üîâ Audio ---
        const AudioSys = {
            ctx: null,
            init: function() {
                window.AudioContext = window.AudioContext || window.webkitAudioContext;
                this.ctx = new AudioContext();
            },
            gearSound: function(pitch) {
                if (!this.ctx) this.init();
                if (this.ctx.state === 'suspended') this.ctx.resume();
                const t = this.ctx.currentTime;
                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                osc.type = 'square';
                osc.frequency.setValueAtTime(60 * pitch, t);
                osc.frequency.exponentialRampToValueAtTime(10, t + 0.15);
                gain.gain.setValueAtTime(0.15, t);
                gain.gain.exponentialRampToValueAtTime(0.001, t + 0.15);
                osc.connect(gain);
                gain.connect(this.ctx.destination);
                osc.start();
                osc.stop(t + 0.15);
            },
            unlockSound: function() {
                if (!this.ctx) this.init();
                const t = this.ctx.currentTime;
                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(100, t);
                osc.frequency.linearRampToValueAtTime(0, t + 1.5);
                gain.gain.setValueAtTime(0.2, t);
                gain.gain.exponentialRampToValueAtTime(0.001, t + 1.5);
                osc.connect(gain);
                gain.connect(this.ctx.destination);
                osc.start();
                osc.stop(t + 1.5);
            }
        };

        // --- üñ•Ô∏è UI / Modal Logic ---
        const UI = {
            finalTime: "00:00",

            showRewardModal: function() {
                const modal = document.getElementById('rewardModal');
                modal.classList.remove('hidden');
                setTimeout(() => modal.classList.remove('opacity-0'), 100);
            },

            showShareModal: function() {
                // Hide Reward Modal
                const reward = document.getElementById('rewardModal');
                reward.classList.add('opacity-0');
                setTimeout(() => reward.classList.add('hidden'), 500);

                // Show Share Modal
                const share = document.getElementById('shareModal');
                const card = document.getElementById('shareCard');
                
                document.getElementById('finalTimeDisplay').innerText = this.finalTime;

                share.classList.remove('hidden');
                setTimeout(() => {
                    share.classList.remove('opacity-0');
                    card.classList.remove('scale-95');
                    card.classList.add('scale-100');
                }, 100);
            },

            share: function(platform) {
                // ÂÆöÁæ©Ë§áË£ΩÁöÑÂÖßÂÆπÔºåÂåÖÂê´ÊôÇÈñìÂíå #Hashtag
                const text = `I unlocked the Golden Clockwork in ${this.finalTime}! Can you solve the mechanism? #PuzzlerWJ`;
                const url = window.location.href;
                
                // ÁµÑÂêàÂÆåÊï¥Ë®äÊÅØ
                const fullMessage = `${text} ${url}`;

                if (platform === 'copy') {
                    navigator.clipboard.writeText(fullMessage).then(() => {
                        // ‰øÆÊîπÈÄôË£°ÔºöÂú®ÂΩàÁ™ó‰∏≠È°ØÁ§∫ÂâõÂâõË§áË£ΩÁöÑÂÖ∑È´îÂÖßÂÆπ
                        alert(`Â∑≤Ë§áË£Ω‰ª•‰∏ãÂÖßÂÆπÂà∞Ââ™Ë≤ºÁ∞ø (Copied):\n\n"${fullMessage}"`);
                    });
                }
            }
        };

        // --- ‚öôÔ∏è Game Logic ---
        const Game = {
            pos: [0, 0, 0], 
            solved: false,

            init: function() {
                const dustCon = document.getElementById('dust-container');
                for(let i=0; i<25; i++) {
                    let d = document.createElement('div');
                    d.className = 'dust';
                    d.style.left = Math.random() * 100 + '%';
                    d.style.top = Math.random() * 100 + '%';
                    d.style.animationDuration = (Math.random() * 15 + 5) + 's';
                    d.style.opacity = Math.random() * 0.6;
                    dustCon.appendChild(d);
                }

                this.pos = [
                    Math.floor(Math.random() * 11) + 1,
                    Math.floor(Math.random() * 11) + 1,
                    Math.floor(Math.random() * 11) + 1
                ];
                
                this.render();
                Timer.start(); // Start timer on load
            },

            handleClick: function(event, gearIdx) {
                if (this.solved) return;
                event.stopPropagation();
                const rect = event.currentTarget.getBoundingClientRect();
                const x = event.clientX - rect.left;
                const dir = x < rect.width / 2 ? -1 : 1;
                this.move(gearIdx, dir);
            },

            move: function(idx, dir) {
                AudioSys.gearSound(1 + (idx * 0.4));
                this.pos[idx] += dir;
                if (idx === 0) this.pos[1] -= dir;
                else if (idx === 1) this.pos[2] += dir;
                else if (idx === 2) this.pos[0] += dir;
                this.render();
                this.check();
            },

            render: function() {
                document.getElementById('g0').style.setProperty('--rotation', `${this.pos[0] * 30}deg`);
                document.getElementById('g1').style.setProperty('--rotation', `${this.pos[1] * 30}deg`);
                document.getElementById('g2').style.setProperty('--rotation', `${this.pos[2] * 30}deg`);
            },

            check: function() {
                const n0 = ((this.pos[0] % 12) + 12) % 12;
                const n1 = ((this.pos[1] % 12) + 12) % 12;
                const n2 = ((this.pos[2] % 12) + 12) % 12;

                const g0 = document.getElementById('g0');
                const g1 = document.getElementById('g1');
                const g2 = document.getElementById('g2');

                if (n0 === 0) g0.classList.add('aligned'); else g0.classList.remove('aligned');
                if (n1 === 0) g1.classList.add('aligned'); else g1.classList.remove('aligned');
                if (n2 === 0) g2.classList.add('aligned'); else g2.classList.remove('aligned');

                const core = document.getElementById('core');
                const status = document.getElementById('status-text');

                if (n0 === 0 && n1 === 0 && n2 === 0) {
                    core.classList.add('active');
                    status.innerText = "READY TO ENGAGE";
                    status.classList.remove('text-amber-500/30');
                    status.classList.add('text-amber-400', 'animate-pulse');
                } else {
                    core.classList.remove('active');
                    status.innerText = "MECHANISM LOCKED";
                    status.classList.add('text-amber-500/30');
                    status.classList.remove('text-amber-400', 'animate-pulse');
                }
            },

            triggerWin: function() {
                if (document.getElementById('core').classList.contains('active')) {
                    this.solved = true;
                    // Stop Timer and save time
                    UI.finalTime = Timer.stop();
                    
                    AudioSys.unlockSound();
                    document.getElementById('status-text').innerText = "OPENING...";
                    
                    // Show Reward Modal
                    UI.showRewardModal();
                } else {
                    const mech = document.getElementById('mechanism');
                    mech.style.transform = "translateX(5px)";
                    setTimeout(() => mech.style.transform = "translateX(-5px)", 50);
                    setTimeout(() => mech.style.transform = "translateX(0)", 100);
                }
            }
        };

        Game.init();
        
        // --- üõ†Ô∏è Debug Function ---
        function debugWin() {
            console.log("Cheating...");
            // 1. Âº∑Âà∂Â∞çÈΩäÊâÄÊúâÈΩíËº™
            Game.pos = [0, 0, 0];
            Game.render();
            
            // 2. Êõ¥Êñ∞ÁãÄÊÖãËÆìÊ†∏ÂøÉÊøÄÊ¥ª (‰∫ÆËµ∑)
            Game.check();
            
            // 3. Âª∂ÈÅ≤‰∏ÄÈªûÈªûÂæåËá™ÂãïËß∏ÁôºÂãùÂà© (Ê®°Êì¨ÈªûÊìäÊ†∏ÂøÉ)
            setTimeout(() => {
                Game.triggerWin();
            }, 100);
        }
    </script>

    <!-- üõ†Ô∏è Debug Button (Ê∏¨Ë©¶Áî®ÔºåÊ≠£Âºè‰∏äÁ∑öÂèØÁßªÈô§) -->
    <button onclick="debugWin()" class="fixed bottom-4 left-4 z-[200] bg-red-600 text-white text-xs px-3 py-2 rounded font-sans opacity-50 hover:opacity-100 hover:scale-105 transition">
        [DEBUG] ‰∏ÄÈçµÈÅéÈóú
    </button>
</body>
</html>