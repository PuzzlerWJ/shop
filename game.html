<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>PuzzlerWJ | The Mechanism</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Abril+Fatface&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- ğŸ¨ Brand Palette Enforcement --- */
        body {
            background-color: #1e1b4b; /* Indigo-950 */
            color: #fbbf24; /* Amber-400 */
            font-family: 'Poppins', sans-serif;
            overflow: hidden;
            touch-action: none;
            user-select: none;
        }

        .brand-font { font-family: 'Abril Fatface', cursive; }

        /* --- âš™ï¸ Gears with Lift Effect --- */
        .gear {
            position: absolute;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-sizing: border-box;
            cursor: pointer; /* è®“æ¸¸æ¨™è®Šæˆæ‰‹å‹ */
            
            /* é—œéµä¿®æ”¹ï¼šä½¿ç”¨ CSS è®Šæ•¸ä¾†åˆ†é›¢ æ—‹è½‰ èˆ‡ ç¸®æ”¾ */
            /* é è¨­æ—‹è½‰ç‚º 0degï¼Œé è¨­ç¸®æ”¾ç‚º 1 */
            transform: rotate(var(--rotation, 0deg)) scale(var(--scale, 1));
            
            /* å¢åŠ  filter transition è®“è®Šäº®çš„æ•ˆæœæ›´å¹³æ»‘ */
            transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1), filter 0.3s ease, box-shadow 0.3s ease;
        }

        /* Hover Effect: "æ‰¶èµ·æ”¾å¤§" */
        .gear:hover {
            --scale: 1.05; /* æ”¾å¤§ 5% */
            filter: brightness(1.2); /* ç¨å¾®è®Šäº®ï¼Œå¢åŠ é«˜äº®æ„Ÿ */
            z-index: 100; /* æš«æ™‚è®“è¢«é¸ä¸­çš„é½’è¼ªå±¤ç´šæé«˜ï¼ˆè¦–è¦ºä¸Šæµ®èµ·ï¼‰ */
        }
        
        /* ç‚ºäº†é¿å… hover æ™‚ z-index æ”¹è®Šå°è‡´å…§å±¤è¢«é®æ“‹çš„ bug
           æˆ‘å€‘éœ€è¦å°æ¯å€‹é½’è¼ªåšå€‹åˆ¥çš„ z-index ç®¡ç†ã€‚
           åŸå‰‡ï¼šå…§å±¤æ°¸é æ¯”å¤–å±¤é«˜ï¼Œä½†åœ¨ hover æ™‚ï¼Œè®“è©²å±¤ç¨å¾®æµ®èµ·ä¸€é»è¦–è¦ºæ•ˆæœã€‚
           å¯¦éš›ä¸Šï¼Œåªè¦ scale å’Œ brightness å°±è¶³å¤ å€åˆ†äº†ã€‚
        */

        /* Layer 1: Outer - Darkest */
        .gear-outer {
            width: 320px; height: 320px;
            background-color: #312e81; /* Indigo-900 */
            border: 8px dashed #4338ca; 
            z-index: 10;
            /* æ­£å¸¸é™°å½± */
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
        }
        .gear-outer:hover {
            /* æµ®èµ·æ™‚é™°å½±åŠ æ·± */
            box-shadow: 0 20px 40px rgba(0,0,0,0.5);
        }

        /* Layer 2: Middle - Medium */
        .gear-middle {
            width: 220px; height: 220px;
            background-color: #4338ca; /* Indigo-700 */
            border: 6px dashed #6366f1; 
            z-index: 20;
            box-shadow: 0 8px 15px rgba(0,0,0,0.3);
        }
        .gear-middle:hover {
            box-shadow: 0 15px 30px rgba(0,0,0,0.5);
        }

        /* Layer 3: Inner - Lightest */
        .gear-inner {
            width: 120px; height: 120px;
            background-color: #6366f1; /* Indigo-500 */
            border: 4px dashed #a5b4fc; 
            z-index: 30;
            box-shadow: 0 5px 10px rgba(0,0,0,0.3);
        }
        .gear-inner:hover {
            box-shadow: 0 10px 20px rgba(0,0,0,0.5);
        }

        @media (min-width: 768px) {
            .gear-outer { width: 450px; height: 450px; border-width: 12px; }
            .gear-middle { width: 300px; height: 300px; border-width: 10px; }
            .gear-inner { width: 160px; height: 160px; border-width: 6px; }
        }

        /* --- ğŸ“ The Markers --- */
        .marker {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            width: 12px; height: 12px;
            border-radius: 50%;
            background-color: rgba(255,255,255,0.2); 
            transition: all 0.3s;
        }

        .gear.aligned .marker {
            background-color: #fbbf24; 
            box-shadow: 0 0 15px #fbbf24;
            transform: translateX(-50%) scale(1.2);
        }

        /* Reference Line */
        .ref-line {
            position: absolute;
            top: -30px; left: 50%;
            transform: translateX(-50%);
            width: 2px; height: 50px;
            background-color: #fbbf24;
            z-index: 5;
            opacity: 0.5;
        }

        /* --- ğŸ–±ï¸ Interaction Zones --- */
        /* 
           é‡è¦ä¿®æ­£ï¼š
           ç‚ºäº†é¿å…é»æ“Šåˆ¤æ–·éŒ¯èª¤ï¼Œæˆ‘å€‘ä¸ä½¿ç”¨è¦†è“‹æ•´åŠé‚Šçš„ click-zoneã€‚
           æˆ‘å€‘ä¾è³´é½’è¼ªæœ¬èº«çš„ hover æ•ˆæœã€‚
           ç‚ºäº†è®“å·¦å³é»æ“Šæ›´ç›´è¦ºï¼Œæˆ‘å€‘åœ¨ JS åˆ¤æ–·é»æ“Šä½ç½®æ˜¯ä½æ–¼é½’è¼ªçš„å·¦åŠéƒ¨é‚„æ˜¯å³åŠéƒ¨ã€‚
        */

        /* --- ğŸ Core Button --- */
        .core {
            position: absolute;
            width: 60px; height: 60px;
            background-color: #1e1b4b;
            border: 2px solid #6366f1;
            border-radius: 50%;
            z-index: 40;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: default;
            transition: all 0.3s;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
        }
        .core i { font-size: 1.5rem; color: #4338ca; transition: color 0.3s; }
        
        .core.active {
            border-color: #fbbf24;
            background-color: #fff;
            cursor: pointer;
            animation: pulse 2s infinite;
        }
        .core.active i { color: #fbbf24; }

        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(251, 191, 36, 0.7); } 70% { box-shadow: 0 0 0 15px rgba(251, 191, 36, 0); } 100% { box-shadow: 0 0 0 0 rgba(251, 191, 36, 0); } }

        #rewardModal { backdrop-filter: blur(5px); }
    </style>
</head>
<body class="flex flex-col items-center justify-center h-screen relative">

    <div class="absolute top-10 text-center z-50">
        <h1 class="brand-font text-3xl text-amber-400 tracking-wide">PuzzlerWJ</h1>
        <p class="text-xs text-indigo-200 mt-1 tracking-widest uppercase">The Synchronization</p>
    </div>

    <a href="index.html" class="absolute top-10 right-10 text-indigo-300 hover:text-white transition z-50">
        <i class="fas fa-times text-2xl"></i>
    </a>

    <!-- Game Container -->
    <div class="relative flex items-center justify-center" id="game-board">
        <div class="ref-line"></div>

        <!-- 
           ä¿®æ”¹äº‹ä»¶ç¶å®šæ–¹å¼ï¼š
           ç›´æ¥åœ¨é½’è¼ª div ä¸Šç¶å®š onclickï¼Œä¸¦å‚³å…¥ event åƒæ•¸
           é€™æ¨£æˆ‘å€‘å¯ä»¥è¨ˆç®—é»æ“Šä½ç½®æ˜¯åœ¨è©²é½’è¼ªçš„å·¦é‚Šé‚„æ˜¯å³é‚Š
        -->

        <!-- Gear 1: Outer -->
        <div class="gear gear-outer" id="g0" onclick="Game.handleClick(event, 0)">
            <div class="marker"></div>
        </div>

        <!-- Gear 2: Middle -->
        <div class="gear gear-middle" id="g1" onclick="Game.handleClick(event, 1)">
            <div class="marker"></div>
        </div>

        <!-- Gear 3: Inner -->
        <div class="gear gear-inner" id="g2" onclick="Game.handleClick(event, 2)">
            <div class="marker"></div>
        </div>

        <!-- Core Center -->
        <div class="core" id="core" onclick="Game.triggerWin()">
            <i class="fas fa-lock"></i>
        </div>
    </div>

    <div class="absolute bottom-12 text-indigo-400/50 text-xs tracking-widest font-mono">
        CLICK LEFT/RIGHT TO ROTATE
    </div>

    <!-- Reward Modal -->
    <div id="rewardModal" class="fixed inset-0 z-[100] hidden flex items-center justify-center bg-indigo-950/80 opacity-0 transition-opacity duration-500">
        <div class="bg-white p-10 rounded-lg text-center shadow-2xl max-w-sm mx-4 border-t-4 border-amber-400">
            <div class="w-16 h-16 bg-amber-100 rounded-full flex items-center justify-center mx-auto mb-4 text-amber-500">
                <i class="fas fa-check text-3xl"></i>
            </div>
            <h2 class="brand-font text-3xl text-indigo-900 mb-2">Solved</h2>
            <p class="text-gray-500 text-sm mb-6">The mechanism is aligned.</p>
            
            <div class="bg-indigo-50 p-4 rounded border border-indigo-100 mb-6">
                <p class="text-[10px] text-indigo-400 uppercase tracking-widest mb-1 font-bold">Secret Code</p>
                <p class="text-2xl font-mono font-bold text-indigo-900 tracking-wider select-all">GEARMASTER</p>
            </div>

            <button onclick="location.reload()" class="text-xs text-gray-400 hover:text-indigo-900 uppercase tracking-widest transition">Play Again</button>
        </div>
    </div>

    <script>
        const AudioSys = {
            ctx: null,
            init: function() {
                window.AudioContext = window.AudioContext || window.webkitAudioContext;
                this.ctx = new AudioContext();
            },
            click: function(pitch) {
                if (!this.ctx) this.init();
                if (this.ctx.state === 'suspended') this.ctx.resume();
                
                const t = this.ctx.currentTime;
                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                
                osc.type = 'sine';
                osc.frequency.setValueAtTime(200 * pitch, t);
                osc.frequency.exponentialRampToValueAtTime(50, t + 0.1);
                
                gain.gain.setValueAtTime(0.2, t);
                gain.gain.exponentialRampToValueAtTime(0.001, t + 0.1);
                
                osc.connect(gain);
                gain.connect(this.ctx.destination);
                osc.start();
                osc.stop(t + 0.1);
            },
            success: function() {
                if (!this.ctx) this.init();
                const t = this.ctx.currentTime;
                [330, 440, 554, 660].forEach((f, i) => {
                    const osc = this.ctx.createOscillator();
                    const gain = this.ctx.createGain();
                    osc.type = 'sine';
                    osc.frequency.value = f;
                    gain.gain.setValueAtTime(0, t);
                    gain.gain.linearRampToValueAtTime(0.1, t + 0.1 + (i*0.05));
                    gain.gain.exponentialRampToValueAtTime(0.001, t + 2);
                    osc.connect(gain);
                    gain.connect(this.ctx.destination);
                    osc.start();
                    osc.stop(t + 2);
                });
            }
        };

        const Game = {
            pos: [0, 0, 0], 
            solved: false,

            init: function() {
                this.pos = [
                    Math.floor(Math.random() * 11) + 1,
                    Math.floor(Math.random() * 11) + 1,
                    Math.floor(Math.random() * 11) + 1
                ];
                this.render();
            },

            // New Click Handler: Detects Left/Right click on the gear itself
            handleClick: function(event, gearIdx) {
                if (this.solved) return;

                // Stop event from bubbling up to underlying gears
                event.stopPropagation();

                // Get click position relative to the clicked element (the gear)
                const rect = event.currentTarget.getBoundingClientRect();
                const x = event.clientX - rect.left; // x position within the element.
                const width = rect.width;

                // If x is less than half width, it's Left side (-1), else Right side (+1)
                const dir = x < width / 2 ? -1 : 1;

                this.move(gearIdx, dir);
            },

            move: function(idx, dir) {
                AudioSys.click(1 + (idx * 0.5));

                this.pos[idx] += dir;

                if (idx === 0) this.pos[1] -= dir;
                else if (idx === 1) this.pos[2] += dir;
                else if (idx === 2) this.pos[0] += dir;

                this.render();
                this.check();
            },

            render: function() {
                // Important: Use CSS Variables for rotation to avoid conflicting with Hover Scale
                document.getElementById('g0').style.setProperty('--rotation', `${this.pos[0] * 30}deg`);
                document.getElementById('g1').style.setProperty('--rotation', `${this.pos[1] * 30}deg`);
                document.getElementById('g2').style.setProperty('--rotation', `${this.pos[2] * 30}deg`);
            },

            check: function() {
                const n0 = ((this.pos[0] % 12) + 12) % 12;
                const n1 = ((this.pos[1] % 12) + 12) % 12;
                const n2 = ((this.pos[2] % 12) + 12) % 12;

                const g0 = document.getElementById('g0');
                const g1 = document.getElementById('g1');
                const g2 = document.getElementById('g2');

                if (n0 === 0) g0.classList.add('aligned'); else g0.classList.remove('aligned');
                if (n1 === 0) g1.classList.add('aligned'); else g1.classList.remove('aligned');
                if (n2 === 0) g2.classList.add('aligned'); else g2.classList.remove('aligned');

                const core = document.getElementById('core');
                if (n0 === 0 && n1 === 0 && n2 === 0) {
                    core.classList.add('active');
                    core.querySelector('i').className = 'fas fa-lock-open';
                } else {
                    core.classList.remove('active');
                    core.querySelector('i').className = 'fas fa-lock';
                }
            },

            triggerWin: function() {
                if (document.getElementById('core').classList.contains('active')) {
                    this.solved = true;
                    AudioSys.success();
                    
                    const modal = document.getElementById('rewardModal');
                    modal.classList.remove('hidden');
                    setTimeout(() => modal.classList.remove('opacity-0'), 100);
                } else {
                    const c = document.getElementById('core');
                    c.style.transform = "translateX(5px)";
                    setTimeout(() => c.style.transform = "translateX(-5px)", 50);
                    setTimeout(() => c.style.transform = "translateX(0)", 100);
                }
            }
        };

        Game.init();
    </script>
</body>
</html>