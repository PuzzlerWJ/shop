<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>PuzzlerWJ | Golden Clockwork</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Abril+Fatface&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- üåå The Void Background --- */
        body {
            background-color: #0f172a; /* Slate 950 base */
            /* Deep Vignette */
            background-image: radial-gradient(circle at 50% 50%, #1e1b4b 0%, #020617 90%);
            color: #fbbf24;
            font-family: 'Abril Fatface', cursive;
            overflow: hidden;
            touch-action: none;
            user-select: none;
        }

        /* Subtle floating dust particles */
        .dust {
            position: absolute;
            width: 2px; height: 2px;
            background: rgba(251, 191, 36, 0.3);
            border-radius: 50%;
            animation: float 10s infinite linear;
            pointer-events: none;
        }

        /* --- ‚öôÔ∏è The Gears (Pure CSS + Textures) --- */
        #mechanism {
            position: relative;
            width: 360px;
            height: 360px;
            display: flex;
            align-items: center;
            justify-content: center;
            /* Enhance depth */
            filter: drop-shadow(0 30px 50px rgba(0,0,0,0.9));
        }

        @media (min-width: 768px) { #mechanism { width: 500px; height: 500px; } }

        /* Base Gear Style */
        .gear {
            position: absolute;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-sizing: border-box;

            /* Logic: Use CSS Variables for independent Rotation & Scale */
            transform: rotate(var(--rotation, 0deg)) scale(var(--scale, 1));
            
            /* Smooth transitions for movement and hover */
            transition: transform 0.5s cubic-bezier(0.34, 1.56, 0.64, 1), filter 0.3s ease, box-shadow 0.3s ease;
        }

        /* HOVER EFFECT: Lift and Brighten */
        .gear:hover {
            --scale: 1.05;
            filter: brightness(1.2) contrast(1.1);
            z-index: 100; /* Temporarily bring to front visually */
        }

        /* 1. Outer Gear: Dark Steel (Heavy) */
        .gear-outer {
            width: 100%; height: 100%;
            z-index: 10;
            border: 12px dashed #334155; /* The Teeth */
            /* Metallic Texture simulation */
            background: radial-gradient(circle, transparent 65%, #1e293b 66%),
                        conic-gradient(from 0deg, #1e293b 0%, #475569 50%, #0f172a 100%);
            box-shadow: inset 0 0 30px #000;
        }
        .gear-outer:hover { box-shadow: inset 0 0 30px #000, 0 0 20px rgba(71, 85, 105, 0.3); }

        /* 2. Middle Gear: Brass (Warm) */
        .gear-middle {
            width: 70%; height: 70%;
            z-index: 20;
            border: 8px dashed #78350f;
            background: radial-gradient(circle, transparent 60%, #92400e 61%),
                        conic-gradient(from 45deg, #b45309 0%, #fbbf24 25%, #78350f 50%, #fbbf24 75%, #b45309 100%);
            box-shadow: 0 10px 20px rgba(0,0,0,0.5), inset 0 0 10px rgba(0,0,0,0.5);
        }
        .gear-middle:hover { box-shadow: 0 15px 30px rgba(0,0,0,0.6), inset 0 0 10px rgba(0,0,0,0.5), 0 0 15px rgba(251, 191, 36, 0.2); }

        /* 3. Inner Gear: Gold (Bright) */
        .gear-inner {
            width: 45%; height: 45%;
            z-index: 30;
            border: 6px dashed #fbbf24;
            background: conic-gradient(from -45deg, #d97706 0%, #fcd34d 40%, #b45309 100%);
            box-shadow: 0 5px 15px rgba(0,0,0,0.6);
        }
        .gear-inner:hover { box-shadow: 0 10px 25px rgba(0,0,0,0.7), 0 0 20px rgba(251, 191, 36, 0.4); }


        /* --- üíé The Gem (Indicator) --- */
        .gem {
            position: absolute;
            top: 6px; 
            left: 50%;
            transform: translateX(-50%);
            width: 10px; height: 10px;
            border-radius: 50%;
            background-color: #0f172a; /* Off state: Dark hole */
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.9);
            transition: all 0.4s;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .gear-middle .gem { top: 4px; width: 12px; height: 12px; }
        .gear-inner .gem { top: 4px; width: 14px; height: 14px; }

        /* Active State */
        .gear.aligned .gem {
            background-color: #fbbf24;
            box-shadow: 0 0 10px #fbbf24, 0 0 20px #fbbf24;
            border-color: #fff;
        }

        /* --- üóùÔ∏è The Core (Keyhole) --- */
        .core {
            position: absolute;
            width: 20%; height: 20%;
            background: radial-gradient(circle at 30% 30%, #475569, #0f172a);
            border-radius: 50%;
            z-index: 40;
            border: 2px solid #334155;
            box-shadow: inset 0 5px 10px rgba(0,0,0,0.8);
            cursor: default;
            transition: all 0.3s;
        }
        .core::after {
            content: '';
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            width: 40%; height: 40%;
            background-color: #000;
            clip-path: polygon(20% 0%, 80% 0%, 100% 100%, 0% 100%); /* Keyhole shape */
            transition: background-color 0.3s;
        }
        
        /* Core Unlock State */
        .core.active {
            border-color: #fbbf24;
            box-shadow: 0 0 30px rgba(251, 191, 36, 0.5);
            cursor: pointer;
            animation: pulse-core 2s infinite;
        }
        .core.active::after { background-color: #fbbf24; box-shadow: 0 0 10px #fbbf24; }

        @keyframes pulse-core { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }

        /* The Reference Beam */
        .ref-line {
            position: absolute;
            top: -40px; left: 50%;
            width: 2px; height: 60px;
            background: linear-gradient(to bottom, #fbbf24, transparent);
            transform: translateX(-50%);
            z-index: 50;
            opacity: 0.6;
            filter: drop-shadow(0 0 5px #fbbf24);
        }

        /* Float Animation for Dust */
        @keyframes float { 0% { transform: translateY(0); opacity: 0; } 50% { opacity: 0.8; } 100% { transform: translateY(-100px); opacity: 0; } }

        #rewardModal { backdrop-filter: blur(15px); }
    </style>
</head>
<body class="flex flex-col items-center justify-center h-screen relative">

    <!-- üåå Dust Particles Container -->
    <div id="dust-container" class="absolute inset-0 pointer-events-none overflow-hidden"></div>

    <!-- Header -->
    <div class="absolute top-10 text-center z-50 pointer-events-none">
        <h1 class="text-3xl text-amber-500/80 tracking-widest drop-shadow-lg">PuzzlerWJ</h1>
        <p class="text-[10px] text-slate-500 mt-1 tracking-[0.3em] uppercase">Golden Clockwork</p>
    </div>

    <!-- Exit -->
    <a href="index.html" class="absolute top-10 right-10 text-slate-600 hover:text-amber-500 transition z-50">
        <i class="fas fa-times text-2xl"></i>
    </a>

    <!-- ‚öôÔ∏è THE GAME BOARD -->
    <div id="mechanism">
        <div class="ref-line"></div>

        <!-- Gear 1: Outer (Dark Steel) -->
        <div class="gear gear-outer" id="g0" onclick="Game.handleClick(event, 0)">
            <div class="gem"></div>
        </div>

        <!-- Gear 2: Middle (Brass) -->
        <div class="gear gear-middle" id="g1" onclick="Game.handleClick(event, 1)">
            <div class="gem"></div>
        </div>

        <!-- Gear 3: Inner (Gold) -->
        <div class="gear gear-inner" id="g2" onclick="Game.handleClick(event, 2)">
            <div class="gem"></div>
        </div>

        <!-- Core -->
        <div class="core" id="core" onclick="Game.triggerWin()"></div>
    </div>

    <!-- Hint Text -->
    <div class="absolute bottom-16 text-amber-500/30 text-xs tracking-[0.2em] font-mono pointer-events-none" id="status-text">
        MECHANISM LOCKED
    </div>

    <!-- üèÜ Reward Modal -->
    <div id="rewardModal" class="fixed inset-0 z-[100] hidden flex items-center justify-center bg-black/60 opacity-0 transition-opacity duration-1000">
        <div class="text-center relative">
            <!-- Glow behind -->
            <div class="absolute inset-0 bg-amber-500/20 blur-3xl rounded-full"></div>
            
            <div class="relative z-10">
                <div class="inline-block w-20 h-20 mb-6 rounded-full border-4 border-amber-500 flex items-center justify-center shadow-[0_0_50px_#fbbf24] bg-black">
                    <i class="fas fa-key text-3xl text-amber-400"></i>
                </div>
                <h1 class="text-4xl text-white mb-2 tracking-widest drop-shadow-xl">UNLOCKED</h1>
                
                <div class="mt-8 bg-black/60 px-8 py-4 rounded border border-amber-500/50 backdrop-blur-md shadow-2xl">
                    <p class="font-sans text-[10px] text-amber-200 uppercase tracking-widest mb-1">Shipping Override Code</p>
                    <p class="font-mono text-2xl text-white tracking-[0.2em] select-all drop-shadow-md">GEARMASTER</p>
                </div>
                
                <button onclick="location.reload()" class="mt-8 text-slate-500 hover:text-white text-xs uppercase tracking-widest transition border-b border-transparent hover:border-white pb-1">Reset Mechanism</button>
            </div>
        </div>
    </div>

    <script>
        // --- üîâ Sound Engine (Mechanical) ---
        const AudioSys = {
            ctx: null,
            init: function() {
                window.AudioContext = window.AudioContext || window.webkitAudioContext;
                this.ctx = new AudioContext();
            },
            gearSound: function(pitch) {
                if (!this.ctx) this.init();
                if (this.ctx.state === 'suspended') this.ctx.resume();
                
                const t = this.ctx.currentTime;
                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                
                // Heavy Mechanical Clack (Square wave)
                osc.type = 'square';
                osc.frequency.setValueAtTime(60 * pitch, t);
                osc.frequency.exponentialRampToValueAtTime(10, t + 0.15);
                
                gain.gain.setValueAtTime(0.15, t);
                gain.gain.exponentialRampToValueAtTime(0.001, t + 0.15);
                
                osc.connect(gain);
                gain.connect(this.ctx.destination);
                osc.start();
                osc.stop(t + 0.15);
            },
            unlockSound: function() {
                if (!this.ctx) this.init();
                const t = this.ctx.currentTime;
                // Steam release hiss
                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(100, t);
                osc.frequency.linearRampToValueAtTime(0, t + 1.5);
                
                gain.gain.setValueAtTime(0.2, t);
                gain.gain.exponentialRampToValueAtTime(0.001, t + 1.5);
                
                osc.connect(gain);
                gain.connect(this.ctx.destination);
                osc.start();
                osc.stop(t + 1.5);
            }
        };

        // --- ‚öôÔ∏è Game Logic ---
        const Game = {
            pos: [0, 0, 0], 
            solved: false,

            init: function() {
                // Initialize Random Dust
                const dustCon = document.getElementById('dust-container');
                for(let i=0; i<25; i++) {
                    let d = document.createElement('div');
                    d.className = 'dust';
                    d.style.left = Math.random() * 100 + '%';
                    d.style.top = Math.random() * 100 + '%';
                    d.style.animationDuration = (Math.random() * 15 + 5) + 's';
                    d.style.opacity = Math.random() * 0.6;
                    dustCon.appendChild(d);
                }

                // Randomize Gear Positions (1-11)
                this.pos = [
                    Math.floor(Math.random() * 11) + 1,
                    Math.floor(Math.random() * 11) + 1,
                    Math.floor(Math.random() * 11) + 1
                ];
                
                this.render();
            },

            // Precise Click Handler
            handleClick: function(event, gearIdx) {
                if (this.solved) return;
                event.stopPropagation(); // Prevent clicking through

                // Determine Left/Right Click based on element width
                const rect = event.currentTarget.getBoundingClientRect();
                const x = event.clientX - rect.left;
                const dir = x < rect.width / 2 ? -1 : 1;

                this.move(gearIdx, dir);
            },

            move: function(idx, dir) {
                AudioSys.gearSound(1 + (idx * 0.4)); // Pitch up for smaller gears

                // The Trinity Linkage Logic
                this.pos[idx] += dir;

                if (idx === 0) this.pos[1] -= dir;      // Outer moves Middle opposite
                else if (idx === 1) this.pos[2] += dir; // Middle moves Inner same
                else if (idx === 2) this.pos[0] += dir; // Inner moves Outer same

                this.render();
                this.check();
            },

            render: function() {
                // Update CSS Variables for Rotation
                document.getElementById('g0').style.setProperty('--rotation', `${this.pos[0] * 30}deg`);
                document.getElementById('g1').style.setProperty('--rotation', `${this.pos[1] * 30}deg`);
                document.getElementById('g2').style.setProperty('--rotation', `${this.pos[2] * 30}deg`);
            },

            check: function() {
                const n0 = ((this.pos[0] % 12) + 12) % 12;
                const n1 = ((this.pos[1] % 12) + 12) % 12;
                const n2 = ((this.pos[2] % 12) + 12) % 12;

                const g0 = document.getElementById('g0');
                const g1 = document.getElementById('g1');
                const g2 = document.getElementById('g2');

                // Light up gems if aligned
                if (n0 === 0) g0.classList.add('aligned'); else g0.classList.remove('aligned');
                if (n1 === 0) g1.classList.add('aligned'); else g1.classList.remove('aligned');
                if (n2 === 0) g2.classList.add('aligned'); else g2.classList.remove('aligned');

                const core = document.getElementById('core');
                const status = document.getElementById('status-text');

                if (n0 === 0 && n1 === 0 && n2 === 0) {
                    core.classList.add('active');
                    status.innerText = "READY TO ENGAGE";
                    status.classList.remove('text-amber-500/30');
                    status.classList.add('text-amber-400', 'animate-pulse');
                } else {
                    core.classList.remove('active');
                    status.innerText = "MECHANISM LOCKED";
                    status.classList.add('text-amber-500/30');
                    status.classList.remove('text-amber-400', 'animate-pulse');
                }
            },

            triggerWin: function() {
                if (document.getElementById('core').classList.contains('active')) {
                    this.solved = true;
                    AudioSys.unlockSound();
                    
                    document.getElementById('status-text').innerText = "OPENING...";
                    
                    const modal = document.getElementById('rewardModal');
                    modal.classList.remove('hidden');
                    setTimeout(() => modal.classList.remove('opacity-0'), 100);
                } else {
                    // Locked Jiggle
                    const mech = document.getElementById('mechanism');
                    mech.style.transform = "translateX(5px)";
                    setTimeout(() => mech.style.transform = "translateX(-5px)", 50);
                    setTimeout(() => mech.style.transform = "translateX(0)", 100);
                }
            }
        };

        Game.init();
    </script>
</body>
</html>