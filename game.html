<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>PuzzlerWJ | Clockwork</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Abril+Fatface&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- üåå The Void Background --- */
        body {
            background-color: #0f172a; /* Slate 950 base */
            /* Deep Vignette */
            background-image: radial-gradient(circle at 50% 50%, #1e1b4b 0%, #020617 90%);
            color: #fbbf24;
            font-family: 'Abril Fatface', cursive;
            overflow: hidden;
            touch-action: none;
            user-select: none;
        }

        /* Subtle floating dust particles */
        .dust {
            position: absolute;
            width: 2px; height: 2px;
            background: rgba(251, 191, 36, 0.3);
            border-radius: 50%;
            animation: float 10s infinite linear;
        }

        /* --- ‚öôÔ∏è The Gears (Pure CSS) --- */
        #mechanism {
            position: relative;
            width: 360px;
            height: 360px;
            /* Center vertically and horizontally */
            display: flex;
            align-items: center;
            justify-content: center;
            filter: drop-shadow(0 20px 40px rgba(0,0,0,0.8));
        }

        @media (min-width: 768px) { #mechanism { width: 500px; height: 500px; } }

        /* Shared Gear Styles */
        .gear {
            position: absolute;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.6s cubic-bezier(0.34, 1.56, 0.64, 1); /* Bouncy mechanical stop */
        }

        /* 1. Outer Gear: Dark Steel */
        .gear-outer {
            width: 100%; height: 100%;
            z-index: 10;
            /* The Teeth */
            border: 12px dashed #334155; 
            /* The Body */
            background: radial-gradient(circle, transparent 65%, #1e293b 66%),
                        conic-gradient(from 0deg, #1e293b 0%, #334155 50%, #0f172a 100%);
            box-shadow: inset 0 0 20px #000;
        }

        /* 2. Middle Gear: Brass */
        .gear-middle {
            width: 70%; height: 70%;
            z-index: 20;
            /* The Teeth */
            border: 8px dashed #78350f;
            /* The Body (Metallic Shine) */
            background: radial-gradient(circle, transparent 60%, #92400e 61%),
                        conic-gradient(from 45deg, #b45309 0%, #fbbf24 25%, #78350f 50%, #fbbf24 75%, #b45309 100%);
            box-shadow: 0 0 15px rgba(0,0,0,0.5), inset 0 0 10px rgba(0,0,0,0.5);
        }

        /* 3. Inner Gear: Gold */
        .gear-inner {
            width: 45%; height: 45%;
            z-index: 30;
            /* The Teeth */
            border: 6px dashed #fbbf24;
            /* The Body */
            background: conic-gradient(from -45deg, #d97706 0%, #fcd34d 40%, #b45309 100%);
            box-shadow: 0 0 10px rgba(0,0,0,0.6);
        }

        /* The "Core" (Keyhole) */
        .core {
            position: absolute;
            width: 20%; height: 20%;
            background: radial-gradient(circle at 30% 30%, #475569, #0f172a);
            border-radius: 50%;
            z-index: 40;
            border: 2px solid #334155;
            box-shadow: inset 0 5px 10px rgba(0,0,0,0.8);
            cursor: pointer;
            transition: all 0.3s;
        }
        .core::after {
            content: '';
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            width: 40%; height: 40%;
            background-color: #000;
            clip-path: polygon(20% 0%, 80% 0%, 100% 100%, 0% 100%); /* Keyhole shape */
        }

        /* --- üíé The Alignment Gem (The Hint) --- */
        .gem {
            position: absolute;
            top: 6px; /* Position near the teeth */
            left: 50%;
            transform: translateX(-50%);
            width: 8px; height: 8px;
            border-radius: 50%;
            background-color: #1e1b4b; /* Dark/Empty state */
            box-shadow: inset 0 1px 2px rgba(0,0,0,0.8);
            transition: all 0.5s;
        }
        .gear-middle .gem { top: 4px; width: 10px; height: 10px; }
        .gear-inner .gem { top: 4px; width: 12px; height: 12px; }

        /* When Aligned: The gem lights up */
        .gear.aligned .gem {
            background-color: #fbbf24; /* Amber light */
            box-shadow: 0 0 10px #fbbf24, 0 0 20px #fbbf24;
        }

        /* The Reference Line (The only static hint) */
        .ref-line {
            position: absolute;
            top: -20px; left: 50%;
            width: 2px; height: 40px;
            background: linear-gradient(to bottom, #fbbf24, transparent);
            transform: translateX(-50%);
            z-index: 50;
            opacity: 0.5;
        }

        /* --- Interaction Zones (Invisible) --- */
        .touch-zone {
            position: absolute;
            width: 50%; height: 100%;
            top: 0; 
            cursor: pointer;
            z-index: 100;
        }
        .left-zone { left: 0; }
        .right-zone { right: 0; }

        /* Animation */
        @keyframes float { 0% { transform: translateY(0); opacity: 0; } 50% { opacity: 0.5; } 100% { transform: translateY(-100px); opacity: 0; } }

        /* Reward Modal */
        #rewardModal { backdrop-filter: blur(10px); }
    </style>
</head>
<body class="flex flex-col items-center justify-center h-screen relative">

    <!-- Ambient Dust Particles -->
    <div id="dust-container" class="absolute inset-0 pointer-events-none overflow-hidden"></div>

    <!-- Minimal Branding (Top Left) -->
    <div class="absolute top-8 left-8 text-amber-500/30 text-xl tracking-widest z-50 pointer-events-none">
        PuzzlerWJ
    </div>

    <!-- Exit (Top Right) -->
    <a href="index.html" class="absolute top-8 right-8 text-slate-700 hover:text-amber-500 transition z-50">
        <i class="fas fa-times text-2xl"></i>
    </a>

    <!-- THE GAME -->
    <div id="mechanism">
        <!-- The Static Goal Line -->
        <div class="ref-line"></div>

        <!-- 1. Outer Gear -->
        <div class="gear gear-outer" id="g0">
            <div class="touch-zone left-zone" onclick="Game.move(0, -1)"></div>
            <div class="touch-zone right-zone" onclick="Game.move(0, 1)"></div>
            <div class="gem"></div> <!-- The Marker -->
        </div>

        <!-- 2. Middle Gear -->
        <div class="gear gear-middle" id="g1">
            <div class="touch-zone left-zone" onclick="Game.move(1, -1)"></div>
            <div class="touch-zone right-zone" onclick="Game.move(1, 1)"></div>
            <div class="gem"></div>
        </div>

        <!-- 3. Inner Gear -->
        <div class="gear gear-inner" id="g2">
            <div class="touch-zone left-zone" onclick="Game.move(2, -1)"></div>
            <div class="touch-zone right-zone" onclick="Game.move(2, 1)"></div>
            <div class="gem"></div>
        </div>

        <!-- Center Core -->
        <div class="core" id="core" onclick="Game.checkWin()"></div>
    </div>

    <!-- Minimal Feedback (Bottom) -->
    <!-- Only shows when mechanism is jammed or unlocked, otherwise empty -->
    <div id="feedback" class="absolute bottom-16 text-amber-500/50 text-sm tracking-[0.3em] h-6 transition-opacity duration-500 opacity-0">
        LOCKED
    </div>

    <!-- Success Modal -->
    <div id="rewardModal" class="fixed inset-0 z-[100] hidden flex items-center justify-center opacity-0 transition-opacity duration-1000 bg-black/60">
        <div class="text-center">
            <div class="inline-block w-20 h-20 mb-6 rounded-full border-4 border-amber-500 flex items-center justify-center shadow-[0_0_30px_#fbbf24]">
                <i class="fas fa-key text-3xl text-amber-400"></i>
            </div>
            <h1 class="text-4xl text-white mb-2">UNLOCKED</h1>
            <div class="mt-8 bg-white/10 px-8 py-4 rounded border border-amber-500/30 backdrop-blur-md">
                <p class="font-sans text-[10px] text-amber-200 uppercase tracking-widest mb-1">Shipping Override Code</p>
                <p class="font-mono text-2xl text-white tracking-widest select-all">GEARMASTER</p>
            </div>
            <button onclick="location.reload()" class="mt-8 text-slate-500 hover:text-white text-xs uppercase tracking-widest transition">Re-lock</button>
        </div>
    </div>

    <script>
        // --- üîâ Minimal Sound Engine ---
        const AudioSys = {
            ctx: null,
            init: function() {
                window.AudioContext = window.AudioContext || window.webkitAudioContext;
                this.ctx = new AudioContext();
            },
            gearSound: function(pitch) {
                if (!this.ctx) this.init();
                if (this.ctx.state === 'suspended') this.ctx.resume();
                
                const t = this.ctx.currentTime;
                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                
                // Mechanical "Clack"
                osc.type = 'square';
                osc.frequency.setValueAtTime(80 * pitch, t);
                osc.frequency.exponentialRampToValueAtTime(0.01, t + 0.15);
                
                gain.gain.setValueAtTime(0.2, t);
                gain.gain.exponentialRampToValueAtTime(0.001, t + 0.15);
                
                osc.connect(gain);
                gain.connect(this.ctx.destination);
                osc.start();
                osc.stop(t + 0.15);
            },
            winSound: function() {
                if (!this.ctx) this.init();
                const t = this.ctx.currentTime;
                // Steam release / Hydraulic open sound
                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                osc.type = 'sawtooth'; // White noise-ish
                osc.frequency.setValueAtTime(50, t);
                osc.frequency.linearRampToValueAtTime(10, t + 1);
                
                gain.gain.setValueAtTime(0.2, t);
                gain.gain.exponentialRampToValueAtTime(0.001, t + 1);
                
                osc.connect(gain);
                gain.connect(this.ctx.destination);
                osc.start();
                osc.stop(t + 1);
            }
        };

        // --- ‚öôÔ∏è Logic ---
        const Game = {
            // We use 12 positions (like a clock)
            // Start randomized
            pos: [0, 0, 0],
            solved: false,

            init: function() {
                // Random starting positions (not 0)
                this.pos = [
                    Math.floor(Math.random() * 11) + 1,
                    Math.floor(Math.random() * 11) + 1,
                    Math.floor(Math.random() * 11) + 1
                ];
                
                // Generate Dust
                const dustCon = document.getElementById('dust-container');
                for(let i=0; i<20; i++) {
                    let d = document.createElement('div');
                    d.className = 'dust';
                    d.style.left = Math.random() * 100 + '%';
                    d.style.top = Math.random() * 100 + '%';
                    d.style.animationDuration = (Math.random() * 10 + 5) + 's';
                    d.style.opacity = Math.random() * 0.5;
                    dustCon.appendChild(d);
                }

                this.render();
            },

            move: function(gearIdx, dir) {
                if (this.solved) return;
                
                AudioSys.gearSound(1 + (gearIdx * 0.5));
                
                // Main Movement
                this.pos[gearIdx] += dir;

                // The Linkage Logic (The Puzzle)
                // Outer(0) moves Middle(1) opposite
                // Middle(1) moves Inner(2) same
                // Inner(2) moves Outer(0) same
                if (gearIdx === 0) this.pos[1] -= dir;
                else if (gearIdx === 1) this.pos[2] += dir;
                else if (gearIdx === 2) this.pos[0] += dir;

                this.render();
                this.checkAlignment();
            },

            render: function() {
                // Apply rotation
                document.getElementById('g0').style.transform = `rotate(${this.pos[0] * 30}deg)`;
                document.getElementById('g1').style.transform = `rotate(${this.pos[1] * 30}deg)`;
                document.getElementById('g2').style.transform = `rotate(${this.pos[2] * 30}deg)`;
            },

            checkAlignment: function() {
                // Check if visually at Top (0, 12, 24...)
                const p0 = ((this.pos[0] % 12) + 12) % 12;
                const p1 = ((this.pos[1] % 12) + 12) % 12;
                const p2 = ((this.pos[2] % 12) + 12) % 12;

                const g0 = document.getElementById('g0');
                const g1 = document.getElementById('g1');
                const g2 = document.getElementById('g2');

                // Visual Feedback for individual gears alignment
                if (p0 === 0) g0.classList.add('aligned'); else g0.classList.remove('aligned');
                if (p1 === 0) g1.classList.add('aligned'); else g1.classList.remove('aligned');
                if (p2 === 0) g2.classList.add('aligned'); else g2.classList.remove('aligned');

                if (p0 === 0 && p1 === 0 && p2 === 0) {
                    this.readyToUnlock();
                } else {
                    document.getElementById('core').style.boxShadow = "inset 0 5px 10px rgba(0,0,0,0.8)";
                    document.getElementById('core').style.borderColor = "#334155";
                    document.getElementById('feedback').style.opacity = "0";
                }
            },

            readyToUnlock: function() {
                // Visual cue on core
                const core = document.getElementById('core');
                core.style.borderColor = "#fbbf24";
                core.style.boxShadow = "0 0 30px #fbbf24";
                
                // Minimal text cue
                const fb = document.getElementById('feedback');
                fb.innerText = "ENGAGED";
                fb.style.opacity = "1";
            },

            checkWin: function() {
                // Re-verify
                const p0 = ((this.pos[0] % 12) + 12) % 12;
                const p1 = ((this.pos[1] % 12) + 12) % 12;
                const p2 = ((this.pos[2] % 12) + 12) % 12;

                if (p0 === 0 && p1 === 0 && p2 === 0) {
                    this.solved = true;
                    AudioSys.winSound();
                    
                    // Animation
                    document.getElementById('feedback').innerText = "OPENING...";
                    
                    setTimeout(() => {
                        const modal = document.getElementById('rewardModal');
                        modal.classList.remove('hidden');
                        setTimeout(() => modal.classList.remove('opacity-0'), 50);
                    }, 800);
                } else {
                    // Jiggle if clicked while locked
                    const c = document.getElementById('mechanism');
                    c.style.transform = "translateX(5px)";
                    setTimeout(() => c.style.transform = "translateX(-5px)", 50);
                    setTimeout(() => c.style.transform = "translateX(0)", 100);
                }
            }
        };

        Game.init();
    </script>
</body>
</html>